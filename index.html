<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control de Invitados</title>

<style>
    * { box-sizing: border-box; }

    body {
        font-family: Arial, sans-serif;
        background: #f5f6f7;
        padding: 20px;
    }

    h2 { margin-bottom: 10px; }

    .controls {
        margin-bottom: 15px;
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
    }

    select, button.toggle-edit {
        padding: 8px 12px;
        font-size: 14px;
        border-radius: 8px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-radius: 12px;
        overflow: hidden;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
        vertical-align: middle;
        word-break: break-word;
    }

    th {
        background: #f0f0f0;
        font-weight: 700;
    }

    tr:nth-child(even) {
        background: #fafafa;
    }

    td.editable {
        background: #fffdf2;
        cursor: text;
    }

    td.locked {
        background: #f3f3f3;
        color: #666;
        cursor: not-allowed;
    }

    button {
        padding: 8px 10px;
        margin: 2px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 13px;
        white-space: nowrap;
    }

    .btn-open { background: #4CAF50; color: white; }
    .btn-copy { background: #2196F3; color: white; }

    .toggle-edit {
        background: #ff9800;
        color: white;
        border-radius: 8px;
    }

    input[type="checkbox"] {
        transform: scale(1.3);
        cursor: pointer;
    }

    /* ==========================
        Responsive (Mobile First)
       Convierte tabla a tarjetas
       ========================== */
    @media (max-width: 720px) {

        body { padding: 12px; }

        h2 { font-size: 18px; }

        .controls {
            gap: 8px;
        }

        select, button.toggle-edit {
            width: 100%;
            font-size: 15px;
        }

        table {
            border: none;
            box-shadow: none;
            background: transparent;
        }

        thead {
            display: none; /* ocultar headers */
        }

        tbody {
            display: block;
        }

        tr {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 12px;
            padding: 12px;
            background: white;
            border-radius: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border: 1px solid #e8e8e8;
        }

        /* quitar zebra */
        tr:nth-child(even) { background: white; }

        td {
            border: none;
            padding: 0;
            text-align: left;
        }

        /* Labels por columna usando nth-child
           (sin tocar HTML) */
        td:nth-child(1)::before { content: "Invitado"; }
        td:nth-child(2)::before { content: "Espacios"; }
        td:nth-child(3)::before { content: "Enlace"; }
        td:nth-child(4)::before { content: "Revisado"; }
        td:nth-child(5)::before { content: "Acciones"; }

        td::before {
            display: block;
            font-size: 12px;
            font-weight: 700;
            color: #555;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        /* Enlace: que no explote el layout */
        td:nth-child(3) {
            word-break: break-all;
        }

        /* Checkbox centrado */
        td:nth-child(4) {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        td:nth-child(4)::before {
            margin: 0;
        }

        /* Acciones como botones apilados o en grid */
        td:nth-child(5) {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        td:nth-child(5)::before {
            grid-column: 1 / -1;
        }

        td:nth-child(5) button {
            width: 100%;
            margin: 0;
            padding: 10px 10px;
            font-size: 14px;
        }
    }
</style>

</head>

<body>

<h2> Control de Invitados</h2>

<div class="controls">
    <label>Filtrar:</label>
    <select id="filtro" onchange="aplicarFiltro()">
        <option value="todos">Todos</option>
        <option value="revisados">Revisados</option>
        <option value="norevisados">No revisados</option>
    </select>

    <button class="toggle-edit" onclick="toggleEdicion()">
        锔 Activar edici贸n
    </button>
</div>

<table id="tabla">
    <thead>
        <tr>
            <th>Invitado</th>
            <th>Espacios</th>
            <th>Enlace</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
let edicionActiva = JSON.parse(localStorage.getItem("edicionActiva")) ?? false;

const datosIniciales = [
    { invitado: "Juan P茅rez", espacios: 2, enlace: "https://example.com/juan", revisado: false },
    { invitado: "Mar铆a L贸pez", espacios: 4, enlace: "https://example.com/maria", revisado: true }
];

const tablaBody = document.querySelector("#tabla tbody");
const btnToggle = document.querySelector(".toggle-edit");

function cargarDatos() {
    let data = JSON.parse(localStorage.getItem("invitados")) || datosIniciales;

    //  Asegurar m铆nimo 90 filas
    const TOTAL_FILAS = 100;
    while (data.length < TOTAL_FILAS) {
        data.push({
            invitado: "",
            espacios: "",
            enlace: "",
            revisado: false
        });
    }

    tablaBody.innerHTML = "";

    data.forEach((fila, index) => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td class="${edicionActiva ? 'editable' : 'locked'}"
                contenteditable="${edicionActiva}"
                oninput="guardarDatos()">${fila.invitado}</td>

            <td class="${edicionActiva ? 'editable' : 'locked'}"
                contenteditable="${edicionActiva}"
                oninput="guardarDatos()">${fila.espacios}</td>

            <td class="${edicionActiva ? 'editable' : 'locked'}"
                contenteditable="${edicionActiva}"
                oninput="guardarDatos()">${fila.enlace}</td>

            <td>
                <input type="checkbox" ${fila.revisado ? "checked" : ""} onchange="guardarDatos()">
            </td>

            <td>
                <button class="btn-open" onclick="abrirEnlace(${index})">Abrir</button>
                <button class="btn-copy" onclick="copiarEnlace(${index})">Copiar</button>
            </td>
        `;

        tablaBody.appendChild(tr);
    });

    actualizarBoton();
    aplicarFiltro();
}


function toggleEdicion() {
    edicionActiva = !edicionActiva;
    localStorage.setItem("edicionActiva", JSON.stringify(edicionActiva));
    cargarDatos();
}

function actualizarBoton() {
    btnToggle.textContent = edicionActiva
        ? " Bloquear edici贸n"
        : "锔 Activar edici贸n";
}

function guardarDatos() {
    const filas = document.querySelectorAll("#tabla tbody tr");
    const data = [];

    filas.forEach(tr => {
        const celdas = tr.children;
        data.push({
            invitado: celdas[0].innerText.trim(),
            espacios: celdas[1].innerText.trim(),
            enlace: celdas[2].innerText.trim(),
            revisado: celdas[3].querySelector("input").checked
        });
    });

    localStorage.setItem("invitados", JSON.stringify(data));
    aplicarFiltro();
}

function abrirEnlace(index) {
    const data = JSON.parse(localStorage.getItem("invitados"));
    window.open(data[index].enlace, "_blank");
}

function copiarEnlace(index) {
    const data = JSON.parse(localStorage.getItem("invitados")) || datosIniciales;
    let url = (data[index].enlace || "").trim();

    // Si el enlace es relativo (ej: "1.html"), convertirlo a URL completa
    if (url && !url.startsWith("http://") && !url.startsWith("https://")) {
        url = new URL(url, window.location.href).href;
    }

    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(url);
    } else {
        const input = document.createElement("input");
        input.value = url;
        document.body.appendChild(input);
        input.select();
        document.execCommand("copy");
        document.body.removeChild(input);
    }

    alert("Enlace copiado 锔\n" + url);
}


function aplicarFiltro() {
    const filtro = document.getElementById("filtro").value;
    const filas = document.querySelectorAll("#tabla tbody tr");

    filas.forEach(tr => {
        const revisado = tr.children[3].querySelector("input").checked;
        tr.style.display =
            filtro === "todos" ||
            (filtro === "revisados" && revisado) ||
            (filtro === "norevisados" && !revisado)
            ? ""
            : "none";
    });
}

cargarDatos();
</script>

</body>
</html>

